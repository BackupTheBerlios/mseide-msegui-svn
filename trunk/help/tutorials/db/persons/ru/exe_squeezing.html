<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Минимизация размера исполняемого файла</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link href="usedstyles.css" rel="stylesheet" type="text/css">
</head>

<body>
 <h3 align="center">Уменьшение размера исполняемого файла</h3>
 <p>Исходный размер исполняемого файла &quot;persons&quot; - 6.109.004 байт.</p>
 <p>Заходим в настройки нашего проекта :</p>
 <ul>
   <li>Project -&gt; Options -&gt; Make <br>
   и смотрим таблицу &quot;Make options&quot;, ищем в ней строку с &quot;-gl&quot; ( включать отладочную информацию ), а в этой строке - столбец, в котором нет крестика. По умолчанию, это будет столбец, озаглавленный цифрой &quot;4&quot;. <br>
   Это значит, что пересобрав проект командой из меню &quot;Project -&gt; Make 4&quot; - мы получим файл без отладочной информации. <br>
   Делаем именно так, без всяких дополнительных настроек - просто &quot;Project -&gt; Make 4&quot;.</li>
 </ul>
 <p>У меня в результате получился размер 1.707.828 байт. </p>
 <p>   Сразу оговорюсь, что здесь, кроме выкидывания отладочной информации, была выполнена &quot;умная линковка&quot; ( опция &quot;-XX&quot; ) с библиотеками FreePascal ( теми, что представлены файлами с шаблонами имен &quot;lib*.a&quot; ) </p>
 <p>Но ни сам проект, ни MSEgui-библиотеки не были подготовлены к &quot;умной линковке&quot;, а потому попали в выходной файл полностью. То есть экономия вышла за счет удаления отладочной информации и взятия необходимого минимума из библиотек FPC.</p>
 <p>Еще большего можно добиться, включив  режим &quot;умной компиляции&quot; ( самого проекта и MSEgui-библиотек, чтобы тоже взять из них необходимый минимум ), вписав в последнюю строку опцию &quot;-CX&quot;, в результате чего получим группу настроек как на рисунке : </p>
 <p>&nbsp;</p>
 <p align="center"><img src="images/make_options.png" width="241" height="132"></p>
 <p align="left">&nbsp;</p>
 <p align="left">Теперь, пересобрав проект той же командой &quot;Project -&gt; Make 4&quot;, получаем размер файла 1.190.068 байт, что очень даже неплохо для сложного DataBase-проекта !</p>
 <p align="left">Зайдя в каталог нашего проекта и в каталоги MSEgui-библиотек, мы тоже увидим там файлы &quot;lib*.a&quot;.</p>
 <p> Имейте ввиду, что :</p>
 <ul>
   <li>версии FreePascal для разработчика ( 2.1.х ) совершенно не обязаны правильно отрабатывать &quot;умные&quot; компиляцию и линковку ! Не удивляйтесь потом, если не получите ожидаемого эффекта. <br>
   </li>
   <li> сборка с ключами &quot;-XX&quot; и &quot;-CX&quot; :
     <ul>
       <li>в десятки раз медленнее обычной сборки ( запускаемой &quot;Project -&gt; Build&quot;  ), и потому - должна использоваться сугубо перед сдачей проекта заказчику <br>
       </li>
       <li>выключает пошаговую отладку ( даже если включена опция отладочной информации &quot;-gl&quot; ) , чтобы вернуть пошаговую отладку, нужно будет пересобрать проект в обычном режиме ( &quot;Project -&gt; Build&quot; ) </li>
     </ul>
   </li>
 </ul>
 <p align="left">Дальнейшее уменьшение размера возможно за счет применения программ-упаковщиков типа UPX, у меня, по команде </p>
 <blockquote>
   <p align="left" class="source">upx -9 ./persons </p>
 </blockquote>
 <p align="left">получился размер файла 457.398 байт. Имейте ввиду, что данное уменьшение имеет свою цену - распакову файла в момент запуска программы ( с ощутимой паузой, &quot;отъеданием&quot; памяти и т.п. ), поэтому - не используйте как самоцель. </p>
 <p align="left">Вообще, а каков минимальный предел размера FPC-программы, со всеми опциями &quot;умной&quot; компиляции и линковки ( ppc386 -mobjfpc -CX -XX {file}.pas; strip -s {file} ) ? </p>
 <p align="left">Пустая программа на FPC-2.0.4 : </p>
 <blockquote>
   <p class="source">program test;<br>
     <br>
     begin<br>
     end.</p>
</blockquote>
 <p align="left">дает 115 Кбайт.</p>
 <p align="left">Та же программа, но задействующая БД-сервисы : </p>
<blockquote>
   <p align="left" class="source">program test;<br>
     <br>
   uses<br>
&nbsp; db, sqldb;<br>
  <br>
  begin<br>
 end.</p>
</blockquote>
 <p align="left">дает уже 552 Кбайт ( транзитом через  увесистую саму-по-себе БД-поддержку  включаются также увесистые модули поддержки 
 &quot;varaints&quot; и &quot;widestring&quot; ) . </p>
 <p align="left">Дальнейшее усложнение этой программы не дает существенного увеличения размера : </p>
 <blockquote>
   <p align="left" class="source">program test;<br>
     uses<br>
&nbsp; db, sqldb, pqconnection;<br>
    <br>
    var<br>
&nbsp;conn: tpqconnection;<br>
&nbsp;qry: tsqlquery;<br>
    <br>
    begin<br>
    end.</p>
 </blockquote>
 <p align="left">всего-то 555 Кбайт, то есть прирост в 3 КБайт.</p>
 <p align="left">Итого мы видим, что вся GUI-поддержка, предоставленная библиотекой MSEgui, заняла 1.1 M - 0.55 M = 550 K. Согласитесь - не очень-то и много. </p>
 <p align="left">&nbsp;</p>
</body>
</html>
